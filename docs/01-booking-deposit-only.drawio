<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" version="28.2.9">
  <diagram name="Booking with Deposit Payment Flow" id="sequence-diagram">
    <mxGraphModel dx="1665" dy="701" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="Booking with Deposit Payment Flow (Deposit Only)&#xa;EV Service Center Management System" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="400" y="20" width="800" height="40" as="geometry" />
        </mxCell>
        <mxCell id="customer-box" value="Customer" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="80" y="100" width="40" height="80" as="geometry" />
        </mxCell>
        <mxCell id="customer-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;exitX=0.461;exitY=1.036;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="customer-options-note" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="1950" as="sourcePoint" />
            <mxPoint x="100" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-51" value="Text" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="customer-line" vertex="1" connectable="0">
          <mxGeometry x="0.78" y="3" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ui-box" value="BookingPage" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="220" y="120" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ui-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="ui-act4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="1950" as="sourcePoint" />
            <mxPoint x="270" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="appsvc-box" value="AppointmentService" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="380" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="appsvc-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="440" y="1970" as="sourcePoint" />
            <mxPoint x="440" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vnpay-box" value="VNPayController" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="560" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vnpay-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="WB9FODUOYhH1B-YFa5yB-65" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="620" y="1950" as="sourcePoint" />
            <mxPoint x="620" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="txsvc-box" value="TransactionService" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="740" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="txsvc-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="800" y="2270" as="sourcePoint" />
            <mxPoint x="800" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gateway-box" value="VNPayGateway" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="920" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="gateway-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="980" y="1950" as="sourcePoint" />
            <mxPoint x="980" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-box" value="Database" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1100" y="120" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="db-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;exitX=0.723;exitY=0.896;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="alt-frame" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1150" y="1950" as="sourcePoint" />
            <mxPoint x="1150" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="email-box" value="EmailService" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1260" y="120" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="email-line" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1310" y="1950" as="sourcePoint" />
            <mxPoint x="1310" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="usecase-note" value="Use Case: Customer đặt cọc 200,000 VND để book lịch hẹn (không chọn dịch vụ)&#xa;Pre-condition: Customer đã đăng nhập, có xe trong hệ thống&#xa;Post-condition: Appointment được tạo với status &quot;confirmed&quot;, cọc đã thanh toán&#xa;Note: Dịch vụ cụ thể sẽ xác định sau khi technician kiểm tra xe" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;size=10;" parent="1" vertex="1">
          <mxGeometry x="80" y="220" width="1280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="phase1-label" value="PHASE 1: CUSTOMER ĐIỀN FORM BOOKING" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#0066CC;" parent="1" vertex="1">
          <mxGeometry x="80" y="300" width="1280" height="20" as="geometry" />
        </mxCell>
        <mxCell id="msg1" value="fillBookingForm()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.4118" y="20" relative="1" as="geometry">
            <mxPoint x="100" y="340" as="sourcePoint" />
            <mxPoint x="270" y="340" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ui-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="265" y="340" width="10" height="80" as="geometry" />
        </mxCell>
        <mxCell id="msg2" value="validateInput()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="ui-act1" edge="1">
          <mxGeometry x="-0.8896" y="30" relative="1" as="geometry">
            <mxPoint x="275" y="360" as="sourcePoint" />
            <mxPoint x="330" y="360" as="targetPoint" />
            <Array as="points">
              <mxPoint x="310" y="360" />
              <mxPoint x="310" y="380" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="validate-note" value="Validate:&#xa;- vehicleId exists&#xa;- scheduledDate valid&#xa;- scheduledTime available&#xa;- bookingType: &quot;deposit_booking&quot;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="285" y="390" width="135" height="90" as="geometry" />
        </mxCell>
        <mxCell id="msg3" value="showBookingPreview()" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;" parent="1" edge="1">
          <mxGeometry x="0.4118" y="-20" relative="1" as="geometry">
            <mxPoint x="270" y="410" as="sourcePoint" />
            <mxPoint x="100" y="410" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg4" value="confirmBooking()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.4118" y="20" relative="1" as="geometry">
            <mxPoint x="100" y="450" as="sourcePoint" />
            <mxPoint x="270" y="450" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ui-act2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="265" y="450" width="10" height="400" as="geometry" />
        </mxCell>
        <mxCell id="phase2-label" value="PHASE 2: TẠO PAYMENT URL" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#0066CC;" parent="1" vertex="1">
          <mxGeometry x="80" y="480" width="1280" height="20" as="geometry" />
        </mxCell>
        <mxCell id="msg5" value="POST /api/vnpay/create-payment" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.2174" y="20" relative="1" as="geometry">
            <mxPoint x="275" y="520" as="sourcePoint" />
            <mxPoint x="620" y="520" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vnpay-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="615" y="520" width="10" height="220" as="geometry" />
        </mxCell>
        <mxCell id="vnpay-req-note" value="Request body:&#xa;- amount: 200000&#xa;- orderInfo: &quot;Thanh toan dat coc xe dien&quot;&#xa;- paymentType: &quot;deposit&quot;&#xa;- appointmentData: {&#xa;    vehicleId, scheduledDate,&#xa;    scheduledTime}" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="625" y="350" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="msg6" value="createTransaction(vnpay, data)" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.8286" y="30" relative="1" as="geometry">
            <mxPoint x="625" y="560" as="sourcePoint" />
            <mxPoint x="800" y="560" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="txsvc-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="795" y="560" width="10" height="100" as="geometry" />
        </mxCell>
        <mxCell id="msg7" value="INSERT Transaction" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.6232" y="20" relative="1" as="geometry">
            <mxPoint x="805" y="580" as="sourcePoint" />
            <mxPoint x="1150" y="580" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="580" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="msg8" value="transactionId" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.683;entryY=0.618;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="db-act1" target="txsvc-act1" edge="1">
          <mxGeometry x="0.025" y="-12" relative="1" as="geometry">
            <mxPoint x="1150" y="610" as="sourcePoint" />
            <mxPoint x="800" y="610" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="1145" y="622" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tx-note" value="Transaction:&#xa;- transactionRef: APP{timestamp}{random}&#xa;- status: &quot;pending&quot;&#xa;- paymentPurpose: &quot;deposit_booking&quot;&#xa;- amount: 200000&#xa;- metadata: {appointmentData}" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="890" y="630" width="220" height="90" as="geometry" />
        </mxCell>
        <mxCell id="msg9" value="Transaction" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;exitX=0.196;exitY=0.897;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="txsvc-act1" edge="1">
          <mxGeometry x="0.2089" relative="1" as="geometry">
            <mxPoint x="790" y="650" as="sourcePoint" />
            <mxPoint x="620" y="650" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="700" y="650" />
              <mxPoint x="700" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="msg10" value="buildPaymentUrl()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=1.095;entryY=0.801;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="vnpay-act1" edge="1">
          <mxGeometry x="-0.4751" relative="1" as="geometry">
            <mxPoint x="625" y="670" as="sourcePoint" />
            <mxPoint x="680" y="670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="660" y="670" />
              <mxPoint x="660" y="696" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vnpay-params-note" value="VNPay params:&#xa;- vnp_TxnRef&#xa;- vnp_Amount: 20000000 (VND * 100)&#xa;- vnp_ReturnUrl&#xa;- vnp_SecureHash" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="635" y="700" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="msg11" value="{paymentUrl, transactionRef, transactionId}" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;" parent="1" edge="1">
          <mxGeometry x="0.4857" relative="1" as="geometry">
            <mxPoint x="620" y="730" as="sourcePoint" />
            <mxPoint x="270" y="730" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="phase3-label" value="PHASE 3: THANH TOÁN TẠI VNPAY" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#0066CC;" parent="1" vertex="1">
          <mxGeometry x="80" y="760" width="1280" height="20" as="geometry" />
        </mxCell>
        <mxCell id="msg12" value="redirect(paymentUrl)" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="275" y="800" as="sourcePoint" />
            <mxPoint x="980" y="800" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gateway-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="975" y="800" width="10" height="60" as="geometry" />
        </mxCell>
        <mxCell id="msg13" value="displayPaymentPage()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.0455" relative="1" as="geometry">
            <mxPoint x="980" y="820" as="sourcePoint" />
            <mxPoint x="100" y="820" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg14" value="enterPaymentInfo()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="100" y="880" as="sourcePoint" />
            <mxPoint x="980" y="880" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gateway-act2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="975" y="880" width="10" height="400" as="geometry" />
        </mxCell>
        <mxCell id="msg15" value="processPayment()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=1.08;entryY=0.074;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="gateway-act2" edge="1">
          <mxGeometry x="-0.6662" y="20" relative="1" as="geometry">
            <mxPoint x="985" y="900" as="sourcePoint" />
            <mxPoint x="1040" y="900" as="targetPoint" />
            <Array as="points">
              <mxPoint x="985" y="890" />
              <mxPoint x="1020" y="890" />
              <mxPoint x="1020" y="910" />
              <mxPoint x="986" y="910" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="alt-frame" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#6c8ebf;strokeWidth=2;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="32.5" y="920" width="1545" height="1540" as="geometry" />
        </mxCell>
        <mxCell id="alt-label" value="alt" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="930" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="alt-cond1" value="[vnp_ResponseCode == &quot;00&quot;] Payment Success" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=2;" parent="1" vertex="1">
          <mxGeometry x="70" y="930" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="msg16" value="GET /api/vnpay/return [vnp_ResponseCode=00]" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="0.5556" y="-30" relative="1" as="geometry">
            <mxPoint x="980" y="980" as="sourcePoint" />
            <mxPoint x="620" y="980" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vnpay-act2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="615" y="980" width="10" height="280" as="geometry" />
        </mxCell>
        <mxCell id="callback-note" value="Callback params:&#xa;- vnp_TxnRef&#xa;- vnp_ResponseCode: &quot;00&quot;&#xa;- vnp_TransactionNo&#xa;- vnp_Amount&#xa;- vnp_SecureHash" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="420" y="970" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="msg17" value="verifyReturnUrl()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0.6;entryY=0.179;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="vnpay-act2" edge="1">
          <mxGeometry x="-0.2991" y="-10" relative="1" as="geometry">
            <mxPoint x="625" y="1010" as="sourcePoint" />
            <mxPoint x="680" y="1010" as="targetPoint" />
            <Array as="points">
              <mxPoint x="660" y="1010" />
              <mxPoint x="660" y="1030" />
              <mxPoint x="630" y="1030" />
              <mxPoint x="630" y="1033" />
              <mxPoint x="626" y="1033" />
              <mxPoint x="626" y="1030" />
            </Array>
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg18" value="SELECT Transaction WHERE transactionRef = vnp_TxnRef" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.2952" y="20" relative="1" as="geometry">
            <mxPoint x="625" y="1050" as="sourcePoint" />
            <mxPoint x="1150" y="1050" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-act2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="1050" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="msg19" value="Transaction" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;" parent="1" edge="1">
          <mxGeometry x="0.2075" y="-20" relative="1" as="geometry">
            <mxPoint x="1150" y="1080" as="sourcePoint" />
            <mxPoint x="620" y="1080" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg20" value="updateTransactionStatus(completed, data)" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.9429" y="30" relative="1" as="geometry">
            <mxPoint x="622.5" y="1119.47" as="sourcePoint" />
            <mxPoint x="797.5" y="1119.47" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="txsvc-act2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="795" y="1110" width="10" height="100" as="geometry" />
        </mxCell>
        <mxCell id="msg21" value="UPDATE Transaction SET status = &#39;completed&#39;" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.6232" y="30" relative="1" as="geometry">
            <mxPoint x="805" y="1130" as="sourcePoint" />
            <mxPoint x="1150" y="1130" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-act3" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="1130" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="update-tx-note" value="Update:&#xa;- status: &#39;completed&#39;&#xa;- responseCode: &#39;00&#39;&#xa;- paidAmount: 200000&#xa;- vnpayData: {bankCode, cardType, payDate}" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="880" y="1160" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="msg22" value="OK" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;" parent="1" source="db-act3" edge="1">
          <mxGeometry x="0.2447" y="-20" relative="1" as="geometry">
            <mxPoint x="1140" y="1160" as="sourcePoint" />
            <mxPoint x="800" y="1160" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg23" value="Transaction" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;" parent="1" edge="1">
          <mxGeometry x="0.2222" y="-20" relative="1" as="geometry">
            <mxPoint x="800" y="1200" as="sourcePoint" />
            <mxPoint x="620" y="1200" as="targetPoint" />
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg24" value="redirect(clientUrl/payment/vnpay-return?success=true)" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.7778" y="20" relative="1" as="geometry">
            <mxPoint x="620" y="1240" as="sourcePoint" />
            <mxPoint x="980" y="1240" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg25" value="redirect" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.1549" y="-20" relative="1" as="geometry">
            <mxPoint x="980" y="1270" as="sourcePoint" />
            <mxPoint x="270" y="1270" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ui-act3" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="265" y="1270" width="10" height="710" as="geometry" />
        </mxCell>
        <mxCell id="msg26" value="displayPaymentSuccess()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;exitX=0.4;exitY=0.075;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="ui-act3" target="phase4-label" edge="1">
          <mxGeometry x="0.6474" y="-20" relative="1" as="geometry">
            <mxPoint x="260" y="1290" as="sourcePoint" />
            <mxPoint x="100" y="1290" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="140" y="1320" />
              <mxPoint x="140" y="1320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="phase4-label" value="PHASE 4: TẠO APPOINTMENT SAU KHI THANH TOÁN THÀNH CÔNG" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#0066CC;" parent="1" vertex="1">
          <mxGeometry x="100" y="1310" width="1220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="msg27" value="POST /api/appointments" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.8182" y="20" relative="1" as="geometry">
            <mxPoint x="275" y="1340" as="sourcePoint" />
            <mxPoint x="440" y="1340" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="appsvc-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="435" y="1330" width="10" height="620" as="geometry" />
        </mxCell>
        <mxCell id="apt-req-note" value="Request body:&#xa;- vehicleId&#xa;- bookingType: &#39;deposit_booking&#39;&#xa;- services: [] (empty)&#xa;- scheduledDate, scheduledTime&#xa;- customerNotes (optional)&#xa;- paymentInfo: {transactionRef}" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="275" y="1352.5" width="160" height="95" as="geometry" />
        </mxCell>
        <mxCell id="msg28" value="SELECT Vehicle WHERE _id = vehicleId AND customerId = userId" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.5887" y="30" relative="1" as="geometry">
            <mxPoint x="445" y="1380" as="sourcePoint" />
            <mxPoint x="1150" y="1380" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-act4" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="1380" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="msg29" value="Vehicle" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;exitX=0.5;exitY=0.75;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="db-act4" edge="1">
          <mxGeometry x="0.4085" y="-20" relative="1" as="geometry">
            <mxPoint x="1140" y="1410" as="sourcePoint" />
            <mxPoint x="440" y="1410" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg30" value="validateVehicleOwnership()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.2222" y="-10" relative="1" as="geometry">
            <mxPoint x="445" y="1430" as="sourcePoint" />
            <mxPoint x="445" y="1450" as="targetPoint" />
            <Array as="points">
              <mxPoint x="480" y="1430" />
              <mxPoint x="480" y="1450" />
              <mxPoint x="445" y="1450" />
            </Array>
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg31" value="generateAppointmentNumber()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0.985;entryY=0.266;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="appsvc-act1" edge="1">
          <mxGeometry x="-0.4498" y="10" relative="1" as="geometry">
            <mxPoint x="445" y="1470" as="sourcePoint" />
            <mxPoint x="500" y="1470" as="targetPoint" />
            <Array as="points">
              <mxPoint x="480" y="1470" />
              <mxPoint x="480" y="1495" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="apt-num-note" value="appointmentNumber: APT{YYMMDD}{random3digits}&#xa;Example: APT250106234" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="480" y="1480" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="msg32" value="INSERT Appointment" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="0.1489" y="10" relative="1" as="geometry">
            <mxPoint x="445" y="1520" as="sourcePoint" />
            <mxPoint x="1150" y="1520" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-act5" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="1520" width="10" height="150" as="geometry" />
        </mxCell>
        <mxCell id="apt-data-note" value="Appointment:&#xa;- appointmentNumber: APT250106234&#xa;- customerId, vehicleId&#xa;- services: [] (empty)&#xa;- bookingType: &#39;deposit_booking&#39;&#xa;- depositInfo: {amount: 200000, paid: true, paidAt: now, transactionId}&#xa;- status: &#39;confirmed&#39;&#xa;- scheduledDate, scheduledTime&#xa;- customerNotes (optional)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1170" y="1520" width="185" height="150" as="geometry" />
        </mxCell>
        <mxCell id="msg33" value="appointmentId" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;" parent="1" edge="1">
          <mxGeometry x="-0.0282" y="-30" relative="1" as="geometry">
            <mxPoint x="1155" y="1660" as="sourcePoint" />
            <mxPoint x="445" y="1660" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg34" value="updateTransactionAppointmentId(transactionRef, appointmentId)" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" target="txsvc-act3" edge="1">
          <mxGeometry x="-0.9148" y="20" relative="1" as="geometry">
            <mxPoint x="445" y="1700" as="sourcePoint" />
            <mxPoint x="800" y="1700" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="txsvc-act3" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="795" y="1685" width="10" height="65" as="geometry" />
        </mxCell>
        <mxCell id="msg35" value="UPDATE Transaction SET appointmentId = appointmentId" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" edge="1">
          <mxGeometry x="-0.8248" y="25" relative="1" as="geometry">
            <mxPoint x="805" y="1705" as="sourcePoint" />
            <mxPoint x="1144.94" y="1705.34" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="804.94" y="1705.84" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="db-act6" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="1900" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="phase5-label" value="PHASE 5: GỬI EMAIL XÁC NHẬN" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#0066CC;" parent="1" vertex="1">
          <mxGeometry x="230" y="1760" width="1220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="par-frame" value="par" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="1205" y="1560" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="email-note" value="Email content:&#xa;- Appointment number: APT250106234&#xa;- Scheduled date &amp; time&#xa;- Service center info&#xa;- Deposit paid: 200,000 VND&#xa;- Note: Dịch vụ cụ thể sẽ xác định&#xa;  sau khi technician kiểm tra xe" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1330" y="1760" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="msg43" value="showAppointmentConfirmation()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;exitX=-0.077;exitY=0.986;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="ui-act3" edge="1">
          <mxGeometry x="1" y="-30" relative="1" as="geometry">
            <mxPoint x="260" y="1970" as="sourcePoint" />
            <mxPoint x="110" y="1970" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="alt-divider" value="" style="endArrow=none;html=1;strokeWidth=2;strokeColor=#6c8ebf;dashed=1;exitX=0;exitY=0.837;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="65.00000000000045" y="1610.2599999999998" as="sourcePoint" />
            <mxPoint x="1380" y="1610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="alt-cond2" value="[vnp_ResponseCode != &quot;00&quot;] Payment Failed" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=2;" parent="1" vertex="1">
          <mxGeometry x="40" y="2010" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="txsvc-act4" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="795" y="2170" width="10" height="100" as="geometry" />
        </mxCell>
        <mxCell id="failed-note" value="Update:&#xa;- status: &#39;failed&#39;&#xa;- errorCode: vnp_ResponseCode&#xa;- errorMessage: &#39;Payment failed&#39;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff9e6;strokeColor=#d6b656;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1170" y="2170" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="msg53" value="" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="1150" y="2040" as="sourcePoint" />
            <mxPoint x="625" y="2040" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-69" value="GET /api/vnpay/return [vnp_ResponseCode != &#39;00&#39;]" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="msg53" vertex="1" connectable="0">
          <mxGeometry x="0.1349" relative="1" as="geometry">
            <mxPoint x="-2" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ui-act4" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="265" y="2300" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="msg54" value="displayPaymentFailed()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry x="0.7059" y="-30" relative="1" as="geometry">
            <mxPoint x="275" y="2340" as="sourcePoint" />
            <mxPoint x="105" y="2340" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="customer-options-note" value="Customer có thể:&#xa;- Retry payment&#xa;- Cancel booking&#xa;- Contact support" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;size=8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="40" y="2360" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="email-act1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1305" y="1760" width="10" height="90" as="geometry" />
        </mxCell>
        <mxCell id="db-act7" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="1685" width="10" height="55" as="geometry" />
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-29" value="par" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;" parent="1" vertex="1">
          <mxGeometry x="70" y="1750" width="1470" height="140" as="geometry" />
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-35" value="[send email confirmation]" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="130" y="1750" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-37" value="SendAppointmentConfirmation(appointmentData, userData)" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" edge="1">
          <mxGeometry x="-0.0367" y="21" relative="1" as="geometry">
            <mxPoint x="445" y="1800" as="sourcePoint" />
            <mxPoint x="1304" y="1800" as="targetPoint" />
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-43" value="" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" edge="1">
          <mxGeometry x="-0.0367" y="21" relative="1" as="geometry">
            <mxPoint x="1307.5" y="1840" as="sourcePoint" />
            <mxPoint x="100" y="1840" as="targetPoint" />
            <mxPoint x="1" as="offset" />
            <Array as="points">
              <mxPoint x="100" y="1840" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-45" value="confirmationEmail" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-43" vertex="1" connectable="0">
          <mxGeometry x="0.9137" y="1" relative="1" as="geometry">
            <mxPoint x="17" y="-11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-54" value="Select Appointment WITH populate(vehicle)&amp;nbsp;" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0.031;entryY=0.292;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="db-act6" edge="1">
          <mxGeometry x="-0.0367" y="21" relative="1" as="geometry">
            <mxPoint x="445" y="1910" as="sourcePoint" />
            <mxPoint x="1140" y="1911" as="targetPoint" />
            <mxPoint x="1" as="offset" />
            <Array as="points">
              <mxPoint x="445" y="1911" />
              <mxPoint x="1041" y="1911" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-56" value="" style="html=1;labelBackgroundColor=#ffffff;startArrow=none;startFill=0;startSize=6;endArrow=classic;endFill=1;endSize=6;jettySize=auto;orthogonalLoop=1;strokeWidth=1;dashed=1;fontSize=14;rounded=0;entryX=1.078;entryY=0.968;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0;exitY=0.75;exitDx=0;exitDy=0;" parent="1" source="db-act6" target="appsvc-act1" edge="1">
          <mxGeometry width="60" height="60" relative="1" as="geometry">
            <mxPoint x="890" y="2080" as="sourcePoint" />
            <mxPoint x="950" y="2020" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-57" value="PopulatedAppointment" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-56" vertex="1" connectable="0">
          <mxGeometry x="0.1023" y="2" relative="1" as="geometry">
            <mxPoint x="-31" y="-12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-60" value="" style="html=1;labelBackgroundColor=#ffffff;startArrow=none;startFill=0;startSize=6;endArrow=classic;endFill=1;endSize=6;jettySize=auto;orthogonalLoop=1;strokeWidth=1;dashed=1;fontSize=14;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.7;entryY=0.958;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="appsvc-act1" target="ui-act3" edge="1">
          <mxGeometry width="60" height="60" relative="1" as="geometry">
            <mxPoint x="430" y="1950" as="sourcePoint" />
            <mxPoint x="270" y="1940" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-62" value="{success: true, data: Appointment}" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-60" vertex="1" connectable="0">
          <mxGeometry x="0.183" y="-1" relative="1" as="geometry">
            <mxPoint x="14" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-63" value="" style="endArrow=none;dashed=1;html=1;rounded=0;exitX=0.002;exitY=0.706;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="alt-frame" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="2150" as="sourcePoint" />
            <mxPoint x="1580" y="2010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-65" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="615" y="2040" width="10" height="250" as="geometry" />
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-73" value="verifyReturnUrl()" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;exitX=1.046;exitY=0.1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1.077;entryY=0.198;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="WB9FODUOYhH1B-YFa5yB-65" target="WB9FODUOYhH1B-YFa5yB-65" edge="1">
          <mxGeometry x="-0.4235" y="5" relative="1" as="geometry">
            <mxPoint x="660" y="2100" as="sourcePoint" />
            <mxPoint x="715" y="2100" as="targetPoint" />
            <Array as="points">
              <mxPoint x="670" y="2065" />
              <mxPoint x="670" y="2090" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-74" value="" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;exitX=0.986;exitY=0.241;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="WB9FODUOYhH1B-YFa5yB-65" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="1225" y="2190" as="sourcePoint" />
            <mxPoint x="1150" y="2110" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="1150" y="2110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-75" value="Select Transaction" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-74" vertex="1" connectable="0">
          <mxGeometry x="0.1349" relative="1" as="geometry">
            <mxPoint x="-183" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-76" value="Transaction" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;" parent="1" edge="1">
          <mxGeometry x="0.3333" y="-20" relative="1" as="geometry">
            <mxPoint x="1150" y="2140" as="sourcePoint" />
            <mxPoint x="625" y="2140" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-77" value="" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="624" y="2170" as="sourcePoint" />
            <mxPoint x="795" y="2170" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="624" y="2170" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-78" value="updateTransactionStatus&lt;br&gt;(failed,data)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-77" vertex="1" connectable="0">
          <mxGeometry x="0.1349" relative="1" as="geometry">
            <mxPoint x="-11" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-81" value="" style="endArrow=block;endFill=1;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;entryX=-0.035;entryY=0.051;entryDx=0;entryDy=0;exitX=0.911;exitY=0.13;exitDx=0;exitDy=0;entryPerimeter=0;exitPerimeter=0;" parent="1" target="WB9FODUOYhH1B-YFa5yB-83" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="804.1099999999999" y="2183.0000000000005" as="sourcePoint" />
            <mxPoint x="1121" y="2210" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-82" value="&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;Update Transaction&lt;br&gt;SET status =&quot;failed&quot;&lt;/blockquote&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-81" vertex="1" connectable="0">
          <mxGeometry x="0.1349" relative="1" as="geometry">
            <mxPoint x="-38" y="-23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-83" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="1145" y="2180" width="10" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-84" value="OK" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=-0.092;exitY=0.816;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" edge="1">
          <mxGeometry x="-0.0005" y="-20" relative="1" as="geometry">
            <mxPoint x="1144.08" y="2230.7999999999997" as="sourcePoint" />
            <mxPoint x="805" y="2230" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-85" value="Transaction" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;entryX=0.989;entryY=0.919;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="WB9FODUOYhH1B-YFa5yB-65" edge="1">
          <mxGeometry x="0.2548" y="-20" relative="1" as="geometry">
            <mxPoint x="800" y="2269" as="sourcePoint" />
            <mxPoint x="750" y="2290" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="625" y="2270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-89" value="" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="WB9FODUOYhH1B-YFa5yB-65" edge="1">
          <mxGeometry x="0.2626" y="-28" relative="1" as="geometry">
            <mxPoint x="1145" y="2280" as="sourcePoint" />
            <mxPoint x="1150" y="2290" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="625" y="2291" />
              <mxPoint x="624" y="2291" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-91" value="&lt;span style=&quot;text-align: left;&quot;&gt;redirect(clientUrl/payment/vnpay-return?success=false&amp;amp;error=...)&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-89" vertex="1" connectable="0">
          <mxGeometry x="-0.755" relative="1" as="geometry">
            <mxPoint x="154" y="-11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-92" value="" style="endArrow=open;endFill=0;html=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=top;strokeWidth=2;dashed=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" edge="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint x="1145" y="2300" as="sourcePoint" />
            <mxPoint x="275" y="2300" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WB9FODUOYhH1B-YFa5yB-93" value="redirect" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="WB9FODUOYhH1B-YFa5yB-92" vertex="1" connectable="0">
          <mxGeometry x="0.9294" y="1" relative="1" as="geometry">
            <mxPoint x="15" y="-11" as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
